<!DOCTYPE html>
<html lang="zh-hant">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.css">

  <link rel="stylesheet" type="text/css" href="../../../theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/font-awesome.min.css">





  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="chairco" />
<meta name="description" content="開始我們第一篇教學吧。一開始還是要感謝 TP 大大的教學文件，覺得一個好的文件遠比看了一堆東抄西抄的文件來的受用，那為什麼要重新寫一次，原因是記得以前讀過一本 羅傑斯(E.M.Rogers)所寫的管理書籍叫做 創新的擴散，大意是創新分了幾個階段，對於我而言接觸 Django 這樣的處理方法也想象成是一種創新，經過評估、試驗與採納。最後希望能夠把這樣一個好方法提供給大家。 環境說明 Django 要開啟一個新的專案主要有幾個步驟： 建立虛擬環境變數 ..." />
<meta name="keywords" content="Coding, Django">
<meta property="og:site_name" content="chairco's blog"/>
<meta property="og:title" content="Django 教學第一篇-專案與環境設定"/>
<meta property="og:description" content="開始我們第一篇教學吧。一開始還是要感謝 TP 大大的教學文件，覺得一個好的文件遠比看了一堆東抄西抄的文件來的受用，那為什麼要重新寫一次，原因是記得以前讀過一本 羅傑斯(E.M.Rogers)所寫的管理書籍叫做 創新的擴散，大意是創新分了幾個階段，對於我而言接觸 Django 這樣的處理方法也想象成是一種創新，經過評估、試驗與採納。最後希望能夠把這樣一個好方法提供給大家。 環境說明 Django 要開啟一個新的專案主要有幾個步驟： 建立虛擬環境變數 ..."/>
<meta property="og:locale" content="zh_TW"/>
<meta property="og:url" content="../../../posts/2016/06/Django-Tutorial-01.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-06-30 13:37:22+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../../../author/chairco.html">
<meta property="article:section" content="Coding"/>
<meta property="article:tag" content="Coding"/>
<meta property="article:tag" content="Django"/>
<meta property="og:image" content="/pics/7709136.png">
  <title>chairco's blog &ndash; Django 教學第一篇-專案與環境設定</title>
</head>
<body>
  <aside>
    <div>
      <a href="../../..">
        <img src="/pics/7709136.png" alt="Jason's Blog" title="Jason's Blog">
      </a>
      <h1><a href="../../..">Jason's Blog</a></h1>
<p>Code / Travel / Other</p>      <nav>
        <ul class="list">
          <li><a href="../../../pages/about-me/#about-me">About&nbsp;Me</a></li>
          <li><a href="http://ptt05643972.pixnet.net/blog" target="_blank">日本旅遊記錄(2014)</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-google" href="#" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-twitter" href="#" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-facebook" href="https://www.facebook.com/profile.php?id=1699706506" target="_blank"><i class="fa fa-facebook"></i></a></li>
        <li><a class="sc-github" href="https://github.com/chairco" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:chairco@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/yichieh-chen-43899688" target="_blank"><i class="fa fa-linkedin"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="../../..">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
    </nav>

<article>
  <header>
    <h1 id="Django-Tutorial-01">Django&nbsp;教學第一篇-專案與環境設定</h1>
    <p>Posted on  6 30, 2016 in <a href="../../../category/coding.html">Coding</a></p>
  </header>
  <div>
    <p>開始我們第一篇教學吧。一開始還是要感謝 <span class="caps">TP</span> 大大的教學文件，覺得一個好的文件遠比看了一堆東抄西抄的文件來的受用，那為什麼要重新寫一次，原因是記得以前讀過一本 羅傑斯(<span class="caps">E.M.</span>Rogers)所寫的管理書籍叫做 <strong>創新的擴散</strong>，大意是創新分了幾個階段，對於我而言接觸 Django&nbsp;這樣的處理方法也想象成是一種創新，經過評估、試驗與採納。最後希望能夠把這樣一個好方法提供給大家。</p>
<h3>環境說明</h3>
<p>Django&nbsp;要開啟一個新的專案主要有幾個步驟：</p>
<ul>
<li>建立虛擬環境變數</li>
<li>開啟專案</li>
<li>建立一個新的 <span class="caps">APP</span></li>
<li>設定專案環境變數與資料夾的&nbsp;setting.py</li>
<li>開始開發程式</li>
</ul>
<p>通常許多教學內容比較少談論到怎麼處理 Django 的環境變數與設定專案資料夾內的 setting.py，因為 Django 是透過專案內的 <code>wsgi.py</code> 這隻檔案把專案變成 <span class="caps">WSGI</span> 應用程式<a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/02-how-does-django-work.md">註1</a>，打開 <code>wsgi.py</code> 的內容會發現它可以設定 <code>setting.py</code> 位置，並透過 <code>setting.py</code> 來處理專案的環境變數，因為這個方式，可以據此來切換不同模式例如 共同設定、開發模式與部署正式機設定<a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/04-run-your-project.md">註3</a>[^3]。</p>
<h3>專案說明</h3>
<p>這次想做一個專案是類似借東西系統，因為有參與產品研發，在研發初期會有很多不同 Function Team&nbsp;要借用產品進行驗證與測試，希望可以透過一個平台根據序號與目的填寫借用表單。</p>
<p>因為一個借用單可能一次包含很多產品需求，因此要能夠一張表單對應多個產品序號。</p>
<h3>建立虛擬環境與設定 Django&nbsp;環境變數</h3>
<p>因為 Python 3.x 已經很成熟了，而且改正了很多 Python 2.x 煩人 <a href="http://uranusjr.logdown.com/posts/2013/12/20/write-python-3-codes-that-run-on-the-python-2-interpreter">Unicode 問題</a>，過去第三方套件也逐漸支援，實在沒有不用的理由。最重要的是 Python 3.x&nbsp;已經內建虛擬環境套件，可以更方便與本機端的套件庫做區隔。</p>
<p>在開發這個專案我們總會需要安裝不同套件，再來 Django 版本也不斷演進，為了不干擾其他專案建立一個虛擬環境 env&nbsp;然後啟動它:</p>
<div class="codehilite"><pre><span></span>python3 -m venv env
source env/bin/activate
(env) 
</pre></div>


<p>這個指令會幫你建立一個 env 的虛擬環境變數（你可以命名為其它的名稱），這等於是建立一個全新的 python 3 環境，可以試試 <code>pip list</code> 原先本機端套件都消失了。不過我習慣在這之前先 update 一下 pip 這個套件然後再進行 Django 的安裝。這個教學撰寫時 Django 已經演進到 1.9.7 版本，如果你還是習慣 1.8.x 版本記得安裝時指定一下 <code>pip install "django&lt;1.9"</code>，但我喜歡 1.9.x 之後 admin&nbsp;畫面所以就安裝最新版:</p>
<div class="codehilite"><pre><span></span>(env)pip install --upgrade pip
(env)pip install django
</pre></div>


<p>現在已經可以先建立一個 Django 專案，這個專案名稱我們就叫&nbsp;borrow:</p>
<div class="codehilite"><pre><span></span>(env)django-admin startproject borrow
</pre></div>


<p>這個專案的結構會像這樣, borrow 這個專案內的 borrow&nbsp;資料夾放的就是專案的環境變數:</p>
<div class="codehilite"><pre><span></span>borrow
├── borrow
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py
</pre></div>


<p>如之前所說，因為開發 Web 時會先在本機端開發，然後再把程式部署到正式機，需要處理環境變數。首先在這邊我會做簡單整理與歸納目前我看到 2&nbsp;種方法：</p>
<table>
<thead>
<tr>
<th align="center">官方</th>
<th align="center"><span class="caps">TP</span></th>
<th align="center">Django Girl</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">全部放在預設 setting.py</td>
<td align="center">建立 settings/ 再區分</td>
<td align="center">全部放在預設 setting.py</td>
</tr>
</tbody>
</table>
<hr />
<p>其實就是建立一個 <code>settings</code> 資料夾再歸納不同的環境變數 <code>.py</code>。
所以接下來將 <code>settings.py</code> 移到 <code>settings</code> 資料夾並改名為 base.py。然後在 settings&nbsp;目錄裡建立三個空白檔案：__init__.py、local.py、production.py:</p>
<div class="codehilite"><pre><span></span>(env)cd cd borrow/borrow
(env)mv settings.py ./settings/base.py
(env)touch __init__.py local.py production.py
</pre></div>


<p>最後專案結構就會像下面一樣:</p>
<div class="codehilite"><pre><span></span>borrow
├── borrow
│   ├── __init__.py
│   ├── settings
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── local.py
│   │   └── production.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py
</pre></div>


<p>接下來照 <span class="caps">TP</span>&nbsp;的解釋這三個新設定作用會是：</p>
<ul>
<li>base.py：用來存放所有設定中共通的部分。</li>
<li>local.py：本機（開發機）用的設定。</li>
<li>production.py：正式部署到 production server&nbsp;時用的設定。</li>
</ul>
<p>新增內容到這 <code>local.py</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;某個產生的 secret key 值，請自行代換&#39;</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<p>修改 <code>base.py</code> 內容 mark <code>SECRET_KEY</code> 和 <code>DEBUG = True</code>, 並起修改 <code>BASE_DIR</code> 如下:</p>
<p><code>BASE_DIR</code> 這個內容是要傳回當前執行檔的所在路徑，因為多了一個 settings 資料夾，因此要再多一層 <code>os.path.dirname()</code> 這個很直覺。</p>
<div class="codehilite"><pre><span></span><span class="c1">#BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="p">)))</span>

<span class="c1"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="c1">#SECRET_KEY = &#39;某個長串亂數值&#39;</span>

<span class="c1"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span class="c1">#DEBUG = True</span>
</pre></div>


<p>前面那個 os.path.dirname() 講得太含糊，順便解釋一下好了 os.path.dirname() 其實就是回傳 os.path.split() 的第一個元素。我乾脆在 <code>settings</code> 底下建立一個 <code>test.py</code> 來印出:</p>
<div class="codehilite"><pre><span></span>print(os.path.abspath(__file__))
/Users/chairco/OneDrive/SourceCode/django/allo/borrow/borrow/settings/test.py

print(os.path.split(os.path.abspath(__file__)))
(&#39;/Users/chairco/OneDrive/SourceCode/django/allo/borrow/borrow/settings&#39;, &#39;test.py&#39;)

print(os.path.dirname(os.path.abspath(__file__)))
/Users/chairco/OneDrive/SourceCode/django/allo/borrow/borrow/settings
</pre></div>


<ul>
<li>第一個範例可以看到因為變數代入是 <code>__file__</code> 所以印出了 <code>test.py</code> 所在位置</li>
<li>第二個範例只是要告訴你 os.path.split() 就是把檔案位置和檔案名稱回傳一個 <code>iterator</code>,&nbsp;第一個元素傳位置，第二個元素傳名稱</li>
<li>第三個範例就是告訴你多加一個 os.path.dirname() 就把檔案位置在上提一層，所以當多加一層目錄就要多一個 os.path.dirname()&nbsp;來往上移動囉。夠直覺了吧。</li>
</ul>
<p>最後來到比較重要部分，因為設定三個 <code>.py</code> 目的就是為了要區分本機開發環境與部署的環境，最前面我們有提到 Django 是透過一個 <code>wsgi.py</code> 來設定環境變數，內容如下:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">django.core.wsgi</span> <span class="kn">import</span> <span class="n">get_wsgi_application</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;borrow.settings&quot;</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">get_wsgi_application</span><span class="p">()</span>
</pre></div>


<p>所以我們在目前的虛擬環境只要告訴 Django 目前要使用的環境變數為 <code>local.py</code>, 然後到部署的環境設定 <code>production.py</code> 為環境變數就大功告成囉。</p>
<div class="codehilite"><pre><span></span>export DJANGO_SETTINGS_MODULE=borrow.settings.local
</pre></div>


<p>為了方便切換到這個虛擬環境，可以將上面設定環境變數寫入到我們虛擬環境的 <code>env/bin/activate</code> 但要記得切換到 env&nbsp;目錄上一層在執行如下指令:</p>
<div class="codehilite"><pre><span></span>(env)echo export DJANGO_SETTINGS_MODULE=borrow.settings.local &gt;&gt; env/bin/activate
</pre></div>


<p>走到這邊大概 Django 的環境也設定差不多了，接下來我們處理一下資料庫的環境變數，就可以進入到第二篇的 <span class="caps">APP</span>&nbsp;開發囉。</p>
<hr />
<p>註 1: WSGI的全寫是 Web Server Gateway Interface，它的發音有點像是&nbsp;whiskey，它是Python定義網頁程式和伺服器溝通的介面。</p>
<p>註 2: 連結文章很清楚說明 Django 的 wsgi.py&nbsp;的目的。</p>
<p>[^3]註 3:&nbsp;網頁開發比較麻煩就是在本機端測試完成後部署到正式機需要不同的環境設定變數，身為開發者當然希望有更聰明與簡單的方式避免出錯，因此針對不同的需求區分環境變數是需要的。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/coding.html">Coding</a>
      <a href="../../../tag/django.html">Django</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'chairco';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
<p>
  &copy; chairco 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79798833-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " chairco's blog ",
  "url" : "../../..",
  "image": "/pics/7709136.png",
  "description": "Jason's Blog"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Django 教學第一篇-專案與環境設定",
  "headline": "Django 教學第一篇-專案與環境設定",
  "datePublished": "2016-06-30 13:37:22+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "chairco",
    "url": "../../../author/chairco.html"
  },
  "image": "/pics/7709136.png",
  "url": "../../../posts/2016/06/Django-Tutorial-01.html",
  "description": "開始我們第一篇教學吧。一開始還是要感謝 TP 大大的教學文件，覺得一個好的文件遠比看了一堆東抄西抄的文件來的受用，那為什麼要重新寫一次，原因是記得以前讀過一本 羅傑斯(E.M.Rogers)所寫的管理書籍叫做 創新的擴散，大意是創新分了幾個階段，對於我而言接觸 Django 這樣的處理方法也想象成是一種創新，經過評估、試驗與採納。最後希望能夠把這樣一個好方法提供給大家。 環境說明 Django 要開啟一個新的專案主要有幾個步驟： 建立虛擬環境變數 ..."
}
</script></body>
</html>