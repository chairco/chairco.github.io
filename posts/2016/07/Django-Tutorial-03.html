<!DOCTYPE html>
<html lang="zh-hant">

<head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Django教學第三篇-用CBV來做程式開發</title>
        <link href="https://chairco.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jason's Blog Full Atom Feed" />
        <link href="https://chairco.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Jason's Blog Full RSS Feed" />
        <link href="https://chairco.me/feeds/django.atom.xml" type="application/atom+xml" rel="alternate" title="Jason's Blog Categories Atom Feed" />
    
    <!-- Bootstrap Core CSS -->
    <link href="../../../theme/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="../../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">-->

    <!-- Custom CSS -->
    <link href="../../../theme/css/clean-blog.min.css" rel="stylesheet">
    <!--<link href="../../../css/clean-blog.min.css" rel="stylesheet">-->

    <!-- So Firefox can bookmark->"abo this site" -->
        <link href="feeds/all.atom.xml" rel="alternate" title="Jason's Blog" type="application/atom+xml">
        <link href="feeds/all.rss.xml" rel="alternate" title="Jason's Blog" type="application/rss+xml">

    <!-- Custom Fonts -->
    <!--<link href="../../../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>-->

    <!-- Code highlight color scheme -->
    <link href="../../../theme/css/code_blocks/tomorrow.css" rel="stylesheet">


    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>-->



        <meta name="description" content="有了觀念之後，在撰寫程式過程中就會有一些很直覺的想法，面對繁瑣的流程也就比較容易駕輕就熟(好像學習數學的感覺啊) 這個教學也希望用這種方法來開發，畢竟一時間要搞懂所有的觀念與技術對多數人來說都比較困難，但做中學讓自己投入，就會像堆積木一樣慢慢把不足的知識補足。 ...">

        <meta name="author" content="chairco(Jason)">

        <meta name="tags" content="Coding">
        <meta name="tags" content="Django">

	    <meta property="og:locale" content="">
    <meta property="og:site_name" content="Jason's Blog">

	<meta property="og:type" content="article">
            <meta property="article:author" content="../../../author/chaircojason.html">
	<meta property="og:url" content="../../../posts/2016/07/Django-Tutorial-03.html">
	<meta property="og:title" content="Django教學第三篇-用CBV來做程式開發">
	<meta property="article:published_time" content="2016-07-06 14:59:23+08:00">
            <meta property="og:description" content="有了觀念之後，在撰寫程式過程中就會有一些很直覺的想法，面對繁瑣的流程也就比較容易駕輕就熟(好像學習數學的感覺啊) 這個教學也希望用這種方法來開發，畢竟一時間要搞懂所有的觀念與技術對多數人來說都比較困難，但做中學讓自己投入，就會像堆積木一樣慢慢把不足的知識補足。 ...">

            <meta property="og:image" content="../../../theme/images/post-bg.jpg">
    
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@ChaircoChen">
        <meta name="twitter:title" content="Django教學第三篇-用CBV來做程式開發">

            <meta name="twitter:image" content="../../../theme/images/post-bg.jpg">
        
            <meta name="twitter:description" content="有了觀念之後，在撰寫程式過程中就會有一些很直覺的想法，面對繁瑣的流程也就比較容易駕輕就熟(好像學習數學的感覺啊) 這個教學也希望用這種方法來開發，畢竟一時間要搞懂所有的觀念與技術對多數人來說都比較困難，但做中學讓自己投入，就會像堆積木一樣慢慢把不足的知識補足。 ...">
    
    <link rel="icon" href="../../../theme/images/myfavicon.ico">
    <link rel="shortcut icon" href="../../../theme/images/myfavicon.ico" type="image/x-icon" />
    <link rel="Bookmark" href="../../../theme/images/myfavicon.ico" type="image/x-icon" />
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    <!--<span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>-->
                </button>
                <a class="navbar-brand" href="../../../">Jason's Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                <li><a href="/pages/about-me/">About</a></li>
                <li><a href="/cv">Resume</a></li>
                <li><a href="/archives.html">Archives</a></li>
                <li><a href="/categories.html">Categories</a></li>
                <li><a href="/tags.html">Tags</a></li>
                <li><a href="/feeds/all.atom.xml">RSS</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('../../../theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Django教學第三篇-用CBV來做程式開發</h1>
                        <span class="meta">Posted by
                                <a href="../../../author/chaircojason.html">chairco(Jason)</a>
                             on  7 06, 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>有了觀念之後，在撰寫程式過程中就會有一些很直覺的想法，面對繁瑣的流程也就比較容易駕輕就熟(好像學習數學的感覺啊)</p>
<p>這個教學也希望用這種方法來開發，畢竟一時間要搞懂所有的觀念與技術對多數人來說都比較困難，但做中學讓自己投入，就會像堆積木一樣慢慢把不足的知識補足。</p>
<p>回顧前面兩篇文章，其實我們已經把整個 Django&nbsp;後端都建立起來。接下來就是將前端與後端做一個橋接，前端就像是一個動作流程，後端就是邏輯執行。</p>
<p>所以在回顧一下流程與程式邏輯:</p>
<div class="codehilite"><pre><span></span>1. 新增表單 -&gt; [urls pattern 找到對應 view] -&gt; [view 根據對應 template] -&gt; [顯示 html]
2. 填寫表單 -&gt; [view 根據 form 找到 model ] -&gt; [ 印出對應欄位給使用者填寫 ] -&gt; [如果有多筆 device， 按下增加按鈕就會透過 js 新增一個欄位給使用者填寫]
3. 送出表單 -&gt; [view 會檢查欄位內容的型態是否正確] -&gt; [正確就會存進資料庫] -&gt; [網站轉址]
</pre></div>


<p>所以我們需要的程式邏輯應該會有:</p>
<ul>
<li>Create, Add loan request:&nbsp;新增表單</li>
<li>Edit, Update loan request:&nbsp;編輯表單</li>
<li>Mixin both form: Loan and Device: Loan 和 Device 兩個 table 的 form&nbsp;要合併在一起。</li>
</ul>
<h3>建立 view 與 form&nbsp;取得資料</h3>
<p>所以我們可以開始建立 view, 首先是新增表單的部分，不要忘記我們也希望使用者在新增表單同時也可以新增 Device 這時就需要透過 forms.py&nbsp;來處理這個部分。</p>
<p>主程式會長這樣，<code>class LoanCreateView()</code> 會繼承 <code>FormsetMixin</code> 和 <code>Createview</code>，前面我們有提到這個繼承自 <code>django.views.generic</code> 的 class <code>Createview</code> 可以協助我們透過 <code>get_form</code> 產生 form class 再與 我們指定的 template_name 結合&nbsp;response。</p>
<div class="codehilite"><pre><span></span><span class="c1">#  loans/views.py</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Loan</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">LoanForm</span><span class="p">,</span> <span class="n">LoanFormSet</span>

<span class="k">class</span> <span class="nc">LoanCreateView</span><span class="p">(</span><span class="n">FormsetMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;loans/loan_formset.html&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Loan</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">LoanForm</span>
    <span class="n">formset_class</span> <span class="o">=</span> <span class="n">LoanFormSet</span>
</pre></div>


<p>如果我們單純只是要處理某一個 table 並把裡面的 field 回傳 form 那大概到這邊就完成了，但因為我還想將 <code>Device</code> table 內的 field&nbsp;也整併一起這時我們就需要做一些處理:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">FormsetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;is_update_view&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>

        <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">formset_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formset_class</span><span class="p">()</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formset</span><span class="p">(</span><span class="n">formset_class</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">formset</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;is_update_view&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>

        <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">formset_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formset_class</span><span class="p">()</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formset</span><span class="p">(</span><span class="n">formset_class</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_invalid</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_formset_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formset_class</span>

    <span class="k">def</span> <span class="nf">get_formset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formset_class</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">formset_class</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_formset_kwargs</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_formset_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;instance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span>
                <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">formset</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">form_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">formset</span><span class="p">))</span>
</pre></div>


<p>首先上面這段程式碼，是讓我們告訴 Django 有兩個 form, 一個是 Loan 的 form 一個是回傳自 <code>forms.py</code> 透過 <code>from django.forms.models import inlineformset_factory</code> 處理過後的 form，然後透過 <code>FormsetMixin</code> 將兩個 form&nbsp;合併之後回傳。</p>
<p>至於 <code>forms.py</code> 是透過 <code>inlineformset_factory</code> 這個函式將 Loan 和 Device 做合併，然後可以設定一開始要印出的數量，還有需要填寫的&nbsp;field。</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">inlineformset_factory</span>

<span class="n">LoanFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span>
    <span class="n">Loan</span><span class="p">,</span> <span class="n">Device</span><span class="p">,</span>
    <span class="n">extra</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">min_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;isn&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<hr />
<p>想不到今天有點拖太久先暫時停筆，等有時間再把內容做更詳細補完和說明吧&nbsp;:)</p>
<hr />
<p>好了，人有惰性，但拖稿也不能拖太久 <span class="caps">XD</span></p>
<p>前面我們透過 <code>views.py</code> 和 <code>forms.py</code> 兩隻程式幫我們處理好後端整合兩個關聯性 table 的邏輯後，接著就可以透過前端撰寫 <code>html</code> 來處理 template&nbsp;展現資料的方法。</p>
<h3>透過 template&nbsp;呈現畫面</h3>
<p>首先我們在 <code>loans/templates/</code> 底下新增一個 html 檔案叫 <code>loan_formset.html</code> 這個 html。其實眼尖的朋友應該想起來 <code>views.py</code> 下面的 <code>class LoanCreateView(FormsetMixin, CreateView)</code> 一開始就有設定一個 <code>template_name</code> 就指向這個檔案位置，也就是說當我們呼叫 <code>class CreateView</code> 下的方法函式 <code>as.view()</code> 他自動會 response 一串 <code>dict</code> 內容給這個 <code>html</code></p>
<p>所以我們開始編輯 <code>loan_formset.html</code>，一樣繼承 <code>loans/_base.html</code>。然後&#8230;</p>
<div class="codehilite"><pre><span></span>{# loans/loan_formset.html #}
{% extends &#39;loans/_base.html&#39; %}

{% load crispy_forms_tags %}

{% block title %}Loans Formset | {{ block.super }}{% endblock title %}

{% block link %}{{ block.super }}
    <span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
    <span class="nc">.errorlist</span> <span class="p">{</span>
        <span class="nb">list-style</span><span class="o">:</span> <span class="nb">none</span><span class="p">;</span>
        <span class="nb">color</span><span class="o">:</span> <span class="m">#B94A48</span><span class="p">;</span>
        <span class="nb">margin</span><span class="o">:</span> <span class="m">0px</span> <span class="m">0px</span> <span class="m">9px</span> <span class="m">0px</span><span class="p">;</span>
        <span class="nb">padding</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
{% endblock link %}

{% block js %}{{ block.super }}
{% endblock js %}

{% block content %}

    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;breadcrumb&quot;</span><span class="p">&gt;</span>
        {% block bar %}{{ block.super }}
            {% if object.purpose %}
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span>{{ object.purpose }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            {% else %}
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span>Loan edit<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            {% endif %}
        {% endblock bar %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;page-header&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{% if form.instance.pk %}Edit{% else %}Add{% endif %} Loans and Device<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;.&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ formset.management_form }}
        {% csrf_token %}

        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Loan<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Loan&quot;</span><span class="p">&gt;</span>
        {{ form|crispy }}

        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Device<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;loans form-inline&quot;</span><span class="p">&gt;</span>
            {% for form in formset %}
                {{ form|crispy }}
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;&lt;/</span><span class="nt">hr</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-actions&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;&lt;/</span><span class="nt">hr</span><span class="p">&gt;</span>

    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

{% endblock content %}
</pre></div>


<p>等等啊，這裡出現一個疑問了。還記得我們在 <code>forms.py</code> 內設定 <code>LoanFomrset</code> 預設的值是 1 啊，那要怎樣讓使用者新增一個新的 field&nbsp;來填寫呢？</p>
<p>沒錯，聰明的你應該已經想到了，就是 Javascript。不要忘記很多前端互動介面還是要仰賴 Javascript&nbsp;來協助我們處理呢。</p>
<p>所以這段 js code&nbsp;就會長成這樣:</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/html&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;loan-template&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;loan-__prefix__&quot;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">formset</span><span class="p">.</span><span class="nx">empty_form</span><span class="o">|</span><span class="nx">crispy</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.add-loan&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">){</span>
        <span class="nx">ev</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_menu_items-TOTAL_FORMS&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">tmplMarkup</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loan-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">compiledTmpl</span> <span class="o">=</span> <span class="nx">tmplMarkup</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/__prefix__/g</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compiledTmpl</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.loans&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">compiledTmpl</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_menu_items-TOTAL_FORMS&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>


<p>程式邏輯就是設定一個變數 <code>count</code> 然後當使用者觸發新增按鈕時，就會把 <code>count + 1</code> 然後根據這個 id 去新增一組&nbsp;field。</p>
<p>同時我們也要新增一個按鈕讓使用者可以新增。所以這段程式碼的整合後樣子就會是這樣:</p>
<div class="codehilite"><pre><span></span>{# loans/loan_formset.html #}
{% extends &#39;loans/_base.html&#39; %}

{% load crispy_forms_tags %}

{% block title %}Loans Formset | {{ block.super }}{% endblock title %}

{% block link %}{{ block.super }}
    <span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
    <span class="nc">.errorlist</span> <span class="p">{</span>
        <span class="nb">list-style</span><span class="o">:</span> <span class="nb">none</span><span class="p">;</span>
        <span class="nb">color</span><span class="o">:</span> <span class="m">#B94A48</span><span class="p">;</span>
        <span class="nb">margin</span><span class="o">:</span> <span class="m">0px</span> <span class="m">0px</span> <span class="m">9px</span> <span class="m">0px</span><span class="p">;</span>
        <span class="nb">padding</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
{% endblock link %}

{% block js %}{{ block.super }}
    {# js 位置 #}
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/html&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;loan-template&quot;</span><span class="p">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;loan-__prefix__&quot;</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="nx">formset</span><span class="p">.</span><span class="nx">empty_form</span><span class="o">|</span><span class="nx">crispy</span> <span class="p">}}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.add-loan&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">){</span>
            <span class="nx">ev</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_menu_items-TOTAL_FORMS&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">tmplMarkup</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loan-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">compiledTmpl</span> <span class="o">=</span> <span class="nx">tmplMarkup</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/__prefix__/g</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compiledTmpl</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.loans&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">compiledTmpl</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_menu_items-TOTAL_FORMS&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

{% endblock js %}

{% block content %}

    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;breadcrumb&quot;</span><span class="p">&gt;</span>
        {% block bar %}{{ block.super }}
            {% if object.purpose %}
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span>{{ object.purpose }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            {% else %}
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span>Loan edit<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            {% endif %}
        {% endblock bar %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;page-header&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{% if form.instance.pk %}Edit{% else %}Add{% endif %} Loans and Device<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;.&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ formset.management_form }}
        {% csrf_token %}

        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Loan<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Loan&quot;</span><span class="p">&gt;</span>
        {{ form|crispy }}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Device<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>

        {# 按鈕位置 #}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pull-right&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary add-loan&quot;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-plus icon-white&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>Add Device<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;loans form-inline&quot;</span><span class="p">&gt;</span>
            {% for form in formset %}
                {{ form|crispy }}
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;&lt;/</span><span class="nt">hr</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-actions&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span><span class="p">&gt;&lt;/</span><span class="nt">hr</span><span class="p">&gt;</span>

    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

{% endblock content %}
</pre></div>


<p>然後 template 就完成囉，那接下來就是告訴 Django 的 <span class="caps">WSGI</span>&nbsp;他要怎麼連到這個頁面。</p>
<h3>urls pattern&nbsp;連接對應的頁面</h3>
<p>這邊就簡單了，想像就像一個程式已經完成，你只是透過一個方法作為程式的進入點。所以我們就打開 <code>loans/urls.py</code>，輸入 <code>url(r'^add/$', views.LoanCreateView.as_view(), name='loan_add'),</code> 到&nbsp;urlpatterns:</p>
<div class="codehilite"><pre><span></span><span class="c1"># loans/urls.py</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoanList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loan_list&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">r&#39;^(?P&lt;pk&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoanDetail</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loan_detail&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">r&#39;^add/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoanCreateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loan_add&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>


<p>不過這邊你一定有個疑問 <code>url(r'^(?P&lt;pk&gt;\d+)/$', views.LoanDetail.as_view(), name='loan_detail'),</code> 這段是幹什麼的啊？</p>
<p>因為我們希望當使用者輸入完成並也送出之後可以看到完成的畫面，有的會寫一個 html 只顯示已完成，但以我們這個範例是跳轉的完成表單的內容，所以回顧一下在 <code>views.py</code> 是哪一段程式碼幫我們處理？</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="p">):</span>        
    <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">formset</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
    <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">())</span>
</pre></div>


<p>可以發現 <code>form_valid</code> 會幫我們確認 <code>field</code> 內容是否有符合規範，然後和建立一個 loan 和 device 的 <code>formset instance</code> 接著儲存。儲存之後會回傳 <code>get_absolute_url()</code> 這個函式，使用者的頁面就會轉換過去。但 <code>get_absolute_url()</code> 是？？？</p>
<p>因為 Django 是一個 <span class="caps">MTV</span> 架構，因此一些固定邏輯我們會希望在 Model 處理，所以我們打開 <code>models.py</code> 回顧一下當時我偷偷加的函式</p>
<p>找到 <code>class Loan</code> 的最下面就看到這個函式，我們透過 decorator <code>@models.permarlink</code> 可以直接呼叫 get_absolute_url()，不過別忘記提供 pk 參數，這樣才知道要取得哪一筆資料。
<em>寫這篇同時發現 2013 後 Django 不建議用 permalink 這個 decorator<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></em></p>
<div class="codehilite"><pre><span></span><span class="nd">@models.permalink</span>
<span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#return reverse(&#39;loan_detail&#39;, kwargs={&#39;pk&#39;: self.pk})</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;loan_detail&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>
</pre></div>


<p>然後再重複一遍開發流程 views -&gt; template。所以在 views.py 建立一個 <code>class LoanDetail(DetailView)</code> 用來取得資料。嘿嘿，有發現用 <span class="caps">CBV</span>&nbsp;好處了嗎？ </p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">LoanDetail</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Loan</span>
</pre></div>


<p>然後再建立 <code>loans/loan_detail.html</code> 的&nbsp;template。</p>
<blockquote>
<p>這邊有人會問說可是在程式碼裡面都沒有告訴 <code>class LoanDetail(DetailView)</code> template 是在哪邊呀？ 這就是 <code>DetailView</code> 聰明的地方，在 class 內有一個 <code>get_context_data</code> 的方法函式預設的 template 內就是 <strong>model 名稱轉小寫 + _detail.html</strong> 當然你也可以用 <code>template_name</code> 來指定囉。</p>
</blockquote>
<div class="codehilite"><pre><span></span>{# loans/loan_detail.html #}
{% extends &#39;loans/_base.html&#39; %}

{% block title %}Loans Detail | {{ block.super }}{% endblock title %}

{% block content %}

    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;breadcrumb&quot;</span><span class="p">&gt;</span>
        {% block bar %}{{ block.super }}
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span>{{ object.purpose }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {% endblock bar %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;page-header&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary pull-right&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;loan_edit&#39; pk=object.pk %}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-edit icon-white&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>Edit<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ object.purpose }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-striped&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>isn<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>config<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>unit no.<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% for item in object.menu_items.all %}
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ item.isn }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ item.config }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ item.unit_no }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>By {{ object.owner }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

{% endblock content %}
</pre></div>


<p>最後我們打開瀏覽器輸入 <code>http://localhost:8000/loan/</code></p>
<p><strong>頁面就會像下面這樣:</strong></p>
<p><img alt="django-tutorial-ch3-p1" src="/pics/201607/django-tutorial-ch3-p1.png" /></p>
<hr />
<p><strong>新增頁面:</strong></p>
<p><img alt="django-tutorial-ch3-p2" src="/pics/201607/django-tutorial-ch3-p2.png" /></p>
<hr />
<p><strong>新增多筆&nbsp;Device:</strong></p>
<p><img alt="django-tutorial-ch3-p3" src="/pics/201607/django-tutorial-ch3-p3.png" /></p>
<hr />
<p>寫到這邊不知不覺已經完成了所有功能，有沒有很興奮呢。
我想要在短短幾篇裡面講完所有重點真的是有點困難，不過好在現在用 <strong>google</strong>&nbsp;大神很容易，當你發現問題或是錯誤訊息時，嘗試尋找一下關鍵字，也許有人也犯過一樣錯誤而且解決了呢。</p>
<p>總之，內容肯定不夠完美，如果有不清楚地方再請包涵囉，那下一篇我們再來加點新功能吧！</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>目前建議是用 <code>from django.core.urlresolvers import reverse</code> 然後 回傳 reverse() 來取代 permalink <a href="http://stackoverflow.com/questions/13503645/what-is-permalink-and-get-absolute-url-in-django">what-is-permalink-and-get-absolute-url-in-django</a>&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
        <div class="twitter">
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="ChaircoChen">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>
        <div class="fb">
            <iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button&size=small&mobile_iframe=true&appId=242673589413437&width=61&height=23" width="61" height="23" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
        </div>
        <div class="g-plus" data-action="share"></div>
    </article>

        <div class="tags">
            <p>tags: <a href="../../../tag/coding.html">Coding</a>, <a href="../../../tag/django.html">Django</a></p>
        </div>

    <hr>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'chairco';
                //var disqus_identifier = 'posts/2016/07/Django-Tutorial-03.html';
                //var disqus_url = '../../../posts/2016/07/Django-Tutorial-03.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//chairco.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
        </div>
    </div>
    </div>
    <hr>

    <!-- Footer -->
    <footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <ul class="list-inline text-center">
                    <li>
                        <a href="#">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-google fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/ChaircoChen">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/chairco">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/chairco">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="http://chairco.me/feeds/all.atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="mailto:chairco@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            </ul>
<p class="copyright text-muted">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="創用 CC 授權條款" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />本著作係採用<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">創用 CC 姓名標示-相同方式分享 4.0 國際 授權條款</a>授權. <br />

    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />
</p>            </div>
        </div>
    </div>
    </footer>

    <!-- jQuery -->
    <script src="../../../theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../../../theme/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../../../theme/js/clean-blog.min.js"></script>
    
    <!-- Analysis -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-79798833-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    
    <!-- DISQUS -->
    <script type="text/javascript">
        var disqus_shortname = 'chairco';
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
<!--
    <section>
        <h2>Discuss</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'chairco';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
    </section>
-->    
    <!-- Redirect HTTP to HTTPS -->
    <script type="text/javascript">
        var host = "chairco.com.tw";
        if ((host == window.location.host) && (window.location.protocol != "https:"))
            window.location.protocol = "https";
    </script>
</body>

</html>