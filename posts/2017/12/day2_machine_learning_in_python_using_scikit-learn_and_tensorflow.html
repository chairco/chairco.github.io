<!DOCTYPE html>
<html lang="zh-hant">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="前一天我們提到二元分類器、並且透過交叉驗證 (cross-validation) 得到準確度並使用 precision/recall tradeoff 調整配適，最後透過 ROC curves, ROC AUC 分數來評估模型。 但如果前面的例子，我們想拓展成能夠分類 0~9 的任一數字呢？接下來就來討論有哪些作法： Randon Forest classifier(隨機森林)或是 ...">
        <meta name="keywords" content="Classification, Python, Scikit-learn">
        
        <link rel="icon" href="https://chairco.github.io/myfavicon.ico">
        <link rel="shortcut icon" href="https://chairco.github.io/myfavicon.ico" type="image/x-icon" />
        <link rel="Bookmark" href="https://chairco.github.io/myfavicon.ico" type="image/x-icon" />

        <title>Day2 一天一篇機器學習 in python using Scikit-Learn and TensorFlow&nbsp;系列 - Jason's Blog</title>

        <!-- Stylesheets -->
        <link href="https://chairco.github.io/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://chairco.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jason's Blog Full Atom Feed" />
        <link href="https://chairco.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Jason's Blog Full RSS Feed" />
        <link href="https://chairco.github.io/feeds/machine-learning.atom.xml" type="application/atom+xml" rel="alternate" title="Jason's Blog Categories Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-79798833-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->


    </head>

    <body>

        <!-- Header -->
    <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('https://chairco.github.io/images/home-bg.jpg'); background-position: center; background-size: cover;">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://chairco.github.io/"><img class="mr20" src="https://chairco.github.io/images/logo.png" alt="logo">Jason's Blog</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="https://chairco.github.io/pages/about-me/">About</a>
                                <a href="https://chairco.github.io/cv">Resume</a>
                                <a href="https://chairco.github.io/categories.html">Categories</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Day2 一天一篇機器學習 in python using Scikit-Learn and TensorFlow&nbsp;系列</h1>
                      <p class="header-date">By <a href="https://chairco.github.io/author/jason.html">Jason</a>, Dec 19, 2017, modified Dec 19, 2017, in category <a href="https://chairco.github.io/category/machine-learning.html">Machine learning</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://chairco.github.io/tag/classification.html">Classification</a>, <a href="https://chairco.github.io/tag/python.html">Python</a>, <a href="https://chairco.github.io/tag/scikit-learn.html">Scikit-learn</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>前一天我們提到二元分類器、並且透過交叉驗證 (cross-validation) 得到準確度並使用 precision/recall tradeoff 調整配適，最後透過 <span class="caps">ROC</span> curves, <span class="caps">ROC</span> <span class="caps">AUC</span>&nbsp;分數來評估模型。</p>
<p>但如果前面的例子，我們想拓展成能夠分類 0~9&nbsp;的任一數字呢？接下來就來討論有哪些作法：</p>
<ul>
<li><code>Randon Forest classifier</code>(隨機森林)或是 <code>navie Bayes</code> classifiers&nbsp;可以直接處理多元分類</li>
<li><code>Support Vector Machine</code> classifiers 或是 <code>Linear</code> classifiers 就是嚴格的二元分類，策略是將他做多個二元分類，看起來就像是多元分類。舉個例，你可以去訓練 0~9 每一個數字 <code>是與否</code>，你就可以訓練出 10 個分類器(0-detector, 1-detector, 2-detector, 3-detector 等等)，然後再做判斷時你只要取得十種二元分類器判斷的最高分。這個又被稱為 one-versus-all(OvA)。林軒田老師的機器學習課程稱： One-Vs-All 策略。另外在這種嚴格二元分類底下還有一種策略是兩兩成對(every pair of digits)，就是將所有數字進行排列組合：(0,1), (0,2), (0,3) &#8230; 所以你需要訓練出 <code>n*(n-1)/2</code> 種分類，這種策略被稱為 one-versus-one(OvO) 以本例 <span class="caps">MNIST</span> 你就會需要訓練出 45&nbsp;種二元分類。好像有點太多了。但他的優點就是訓練時你只要挑兩類(以本例為數字)來做訓練。</li>
</ul>
<p>兩種演算法個適合在不同的使用情境，例如 Support Vector Machine 會隨著訓練的規模縮小而效能較好，因此如果你的訓練資料是比較小的，那會比較建議用 OvO，但多數時候的二元分類演算法會偏好使用&nbsp;OvA。</p>
<p>使用 sickit-learn 做多元分類時預設是使用 OvA 策略。除了 <span class="caps">SVM</span> 分類器會使用 <span class="caps">OVO</span> 策略，接著我們就來試試&nbsp;SGDClassifier:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">sgd_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="c1"># y_train, not y_train_5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sgd_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">some_digit</span><span class="p">])</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">5.</span><span class="p">])</span>
</pre></div>


<p>上面我們的訓練資料就不能放 y_train_5 而要放 y_train，非常簡單，sickit-learn 就會根據我們給的訓練資料開始訓練 10 個二元分類器。然後根據不同的圖片計算 decision score。可以呼叫 decision_function() 這是會回傳 10&nbsp;組實例的分數。</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">some_digit_scores</span> <span class="o">=</span> <span class="n">sgd_clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">([</span><span class="n">some_digit</span><span class="p">])</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">some_digit_scores</span>
<span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">311402.62954431</span><span class="p">,</span> <span class="o">-</span><span class="mf">363517.28355739</span><span class="p">,</span> <span class="o">-</span><span class="mf">446449.5306454</span> <span class="p">,</span>
        <span class="o">-</span><span class="mf">183226.61023518</span><span class="p">,</span> <span class="o">-</span><span class="mf">414337.15339485</span><span class="p">,</span>  <span class="mf">161855.74572176</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">452576.39616343</span><span class="p">,</span> <span class="o">-</span><span class="mf">471957.14962573</span><span class="p">,</span> <span class="o">-</span><span class="mf">518542.33997148</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">536774.63961222</span><span class="p">]])</span>
</pre></div>


<p>接著我們可以看看最高分數位於哪個位置。</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">some_digit_scores</span><span class="p">)</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sgd_clf</span><span class="o">.</span><span class="n">classes_</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">,</span>  <span class="mf">4.</span><span class="p">,</span>  <span class="mf">5.</span><span class="p">,</span>  <span class="mf">6.</span><span class="p">,</span>  <span class="mf">7.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span>  <span class="mf">9.</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sgd_clf</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="mf">5.0</span>
</pre></div>


<p>可以很清楚看見答案是 5，在這個例子當中只是剛好 5 位於陣列 5&nbsp;的位置。</p>
<p>用 OvO 的策略來訓練，可以選 OneVsOneClassifier or OneVsRestClassifier classes 然後根據&nbsp;SGDClassifier：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.multiclass</span> <span class="kn">import</span> <span class="n">OneVsOneClassifier</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ovo_clf</span> <span class="o">=</span> <span class="n">OneVsOneClassifier</span><span class="p">(</span><span class="n">SGDClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ovo_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ovo_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">some_digit</span><span class="p">])</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">5.</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ovo_clf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">)</span>
<span class="mi">45</span>
</pre></div>


<p>用 RandomForestClassifier 演算法，注意是用 RandomForest 就不需要選用 OvO 或是 OvA，因為 RandomForest&nbsp;可以直接處理多元分類。</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">forest_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">forest_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">some_digit</span><span class="p">])</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">5.</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">forest_clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">([</span><span class="n">some_digit</span><span class="p">])</span>
<span class="n">array</span><span class="p">([[</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">0.1</span><span class="p">,</span>  <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">0.8</span><span class="p">,</span>  <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">0.</span> <span class="p">]])</span>
</pre></div>


<p>用 Predict_proba 印出每個訓練資料是 5 的概率。index 5 有 80% 機率為 5，也可發現在 0 或是 3 某些機率下也會被判斷成 5，接著用交叉驗證(cross-validation) 確認 SGDClassifier 的&nbsp;accurancy:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">0.87767447</span><span class="p">,</span>  <span class="mf">0.84059203</span><span class="p">,</span>  <span class="mf">0.85477822</span><span class="p">])</span>
</pre></div>


<p>拆解成 k-folds 測試得到 84% 準確度，如果使用隨機分類會得到 10%&nbsp;準確度，看起來不錯。但我們可以讓他更好一些：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">,</span> <span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">0.91376725</span><span class="p">,</span>  <span class="mf">0.90954548</span><span class="p">,</span>  <span class="mf">0.90718608</span><span class="p">])</span>
</pre></div>


<p>分析錯誤一樣用到混淆矩陣 (Confuion&nbsp;Matrix) </p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">,</span> <span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">conf_mx</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="n">conf_mx</span>
<span class="n">array</span><span class="p">([[</span><span class="mi">5729</span><span class="p">,</span>    <span class="mi">2</span><span class="p">,</span>   <span class="mi">22</span><span class="p">,</span>    <span class="mi">8</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">50</span><span class="p">,</span>   <span class="mi">48</span><span class="p">,</span>    <span class="mi">9</span><span class="p">,</span>   <span class="mi">41</span><span class="p">,</span>    <span class="mi">4</span><span class="p">],</span>
       <span class="p">[</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">6487</span><span class="p">,</span>   <span class="mi">44</span><span class="p">,</span>   <span class="mi">25</span><span class="p">,</span>    <span class="mi">6</span><span class="p">,</span>   <span class="mi">42</span><span class="p">,</span>    <span class="mi">5</span><span class="p">,</span>    <span class="mi">9</span><span class="p">,</span>  <span class="mi">110</span><span class="p">,</span>   <span class="mi">12</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">50</span><span class="p">,</span>   <span class="mi">40</span><span class="p">,</span> <span class="mi">5347</span><span class="p">,</span>   <span class="mi">95</span><span class="p">,</span>   <span class="mi">85</span><span class="p">,</span>   <span class="mi">28</span><span class="p">,</span>   <span class="mi">87</span><span class="p">,</span>   <span class="mi">53</span><span class="p">,</span>  <span class="mi">159</span><span class="p">,</span>   <span class="mi">14</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">48</span><span class="p">,</span>   <span class="mi">38</span><span class="p">,</span>  <span class="mi">135</span><span class="p">,</span> <span class="mi">5331</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>  <span class="mi">253</span><span class="p">,</span>   <span class="mi">32</span><span class="p">,</span>   <span class="mi">54</span><span class="p">,</span>  <span class="mi">144</span><span class="p">,</span>   <span class="mi">95</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">17</span><span class="p">,</span>   <span class="mi">25</span><span class="p">,</span>   <span class="mi">41</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span> <span class="mi">5350</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">55</span><span class="p">,</span>   <span class="mi">30</span><span class="p">,</span>   <span class="mi">87</span><span class="p">,</span>  <span class="mi">217</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">69</span><span class="p">,</span>   <span class="mi">38</span><span class="p">,</span>   <span class="mi">35</span><span class="p">,</span>  <span class="mi">189</span><span class="p">,</span>   <span class="mi">75</span><span class="p">,</span> <span class="mi">4614</span><span class="p">,</span>   <span class="mi">97</span><span class="p">,</span>   <span class="mi">25</span><span class="p">,</span>  <span class="mi">183</span><span class="p">,</span>   <span class="mi">96</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">33</span><span class="p">,</span>   <span class="mi">24</span><span class="p">,</span>   <span class="mi">50</span><span class="p">,</span>    <span class="mi">2</span><span class="p">,</span>   <span class="mi">39</span><span class="p">,</span>  <span class="mi">102</span><span class="p">,</span> <span class="mi">5609</span><span class="p">,</span>    <span class="mi">5</span><span class="p">,</span>   <span class="mi">53</span><span class="p">,</span>    <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">24</span><span class="p">,</span>   <span class="mi">19</span><span class="p">,</span>   <span class="mi">77</span><span class="p">,</span>   <span class="mi">26</span><span class="p">,</span>   <span class="mi">60</span><span class="p">,</span>   <span class="mi">12</span><span class="p">,</span>    <span class="mi">4</span><span class="p">,</span> <span class="mi">5798</span><span class="p">,</span>   <span class="mi">18</span><span class="p">,</span>  <span class="mi">227</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">42</span><span class="p">,</span>  <span class="mi">148</span><span class="p">,</span>   <span class="mi">70</span><span class="p">,</span>  <span class="mi">146</span><span class="p">,</span>   <span class="mi">11</span><span class="p">,</span>  <span class="mi">161</span><span class="p">,</span>   <span class="mi">57</span><span class="p">,</span>   <span class="mi">18</span><span class="p">,</span> <span class="mi">5062</span><span class="p">,</span>  <span class="mi">136</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">40</span><span class="p">,</span>   <span class="mi">34</span><span class="p">,</span>   <span class="mi">28</span><span class="p">,</span>   <span class="mi">85</span><span class="p">,</span>  <span class="mi">161</span><span class="p">,</span>   <span class="mi">32</span><span class="p">,</span>    <span class="mi">2</span><span class="p">,</span>  <span class="mi">203</span><span class="p">,</span>   <span class="mi">81</span><span class="p">,</span> <span class="mi">5283</span><span class="p">]])</span>
</pre></div>


<p>但都是數字不是很明顯，將它轉成以顏色為主的方格來看，</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">conf_mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix_plot&quot;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="#" src="https://i.imgur.com/jUksCQT.png" /></p>
<p>主對角線上的值代表圖片正確的預測，所以呈現一個對角線，唔，看起來非常的不錯！</p>
<p>但我們也關注錯誤的分類。首先我們將混淆矩陣內錯誤數量除以圖片的的數量得到一個比例，這樣可以協助我們繪製圖表：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">row_sums</span> <span class="o">=</span> <span class="n">conf_mx</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">norm_conf_mx</span> <span class="o">=</span> <span class="n">conf_mx</span> <span class="o">/</span> <span class="n">row_sums</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">norm_conf_mx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">norm_conf_mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix_errors_plot&quot;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="#" src="https://i.imgur.com/th0ZFtg.png" /></p>
<p>這張圖 row（行）是指實際的值，column（列）是指預測得值。從圖上的顏色可以發現 column 上的 8, 9 兩個數字底色接近白色的數量遠多於其他數字，代表很多數字被錯誤分類到 8, 9 相反的像是數字 1 的底色多數為黑，這代表多數情況下 1 都可以被正確分類（雖然部分與 8&nbsp;混淆）。注意是錯誤不一定都是對稱的。</p>
<p>分析混淆矩陣有助於你了解與改善分類器，以這個例子為例，你就可以花費較多的心力來改善對於數字 8, 9 的改善。或是撰寫演算法來計算 closed loop 的數量，或是使用 scikit-image, Pillow, OpenCV&nbsp;來改善。</p>
<p>雖然分析這些個別的錯誤可以有助了解分類器錯誤原因，但卻是耗時的。我們嘗試畫 3, 5&nbsp;兩個數字來看看：</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_digits</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">images_per_row</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">28</span>
    <span class="n">images_per_row</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">),</span> <span class="n">images_per_row</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">instance</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">]</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">images_per_row</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">row_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_empty</span> <span class="o">=</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="n">images_per_row</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="n">n_empty</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">rimages</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="n">images_per_row</span> <span class="p">:</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">images_per_row</span><span class="p">]</span>
        <span class="n">row_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">rimages</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">row_images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">cl_a</span><span class="p">,</span> <span class="n">cl_b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">X_aa</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[(</span><span class="n">y_train</span> <span class="o">==</span> <span class="n">cl_a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_train_pred</span> <span class="o">==</span> <span class="n">cl_a</span><span class="p">)]</span>
<span class="n">X_ab</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[(</span><span class="n">y_train</span> <span class="o">==</span> <span class="n">cl_a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_train_pred</span> <span class="o">==</span> <span class="n">cl_b</span><span class="p">)]</span>
<span class="n">X_ba</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[(</span><span class="n">y_train</span> <span class="o">==</span> <span class="n">cl_b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_train_pred</span> <span class="o">==</span> <span class="n">cl_a</span><span class="p">)]</span>
<span class="n">X_bb</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[(</span><span class="n">y_train</span> <span class="o">==</span> <span class="n">cl_b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_train_pred</span> <span class="o">==</span> <span class="n">cl_b</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">plot_digits</span><span class="p">(</span><span class="n">X_aa</span><span class="p">[:</span><span class="mi">25</span><span class="p">],</span> <span class="n">images_per_row</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">);</span> <span class="n">plot_digits</span><span class="p">(</span><span class="n">X_ab</span><span class="p">[:</span><span class="mi">25</span><span class="p">],</span> <span class="n">images_per_row</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">);</span> <span class="n">plot_digits</span><span class="p">(</span><span class="n">X_ba</span><span class="p">[:</span><span class="mi">25</span><span class="p">],</span> <span class="n">images_per_row</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">);</span> <span class="n">plot_digits</span><span class="p">(</span><span class="n">X_bb</span><span class="p">[:</span><span class="mi">25</span><span class="p">],</span> <span class="n">images_per_row</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;error_analysis_digits_plot&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="#" src="https://i.imgur.com/cpUtaJ8.png" /></p>
<p>其實用肉眼可以看出像是第八行的 5 看起來就很像 3。我們也可以解釋為什麼 SGDClassifier 再進行一些分類時會出現錯誤，分類器只是一個簡單的線性模型，對於分辨方式是給予每個像素一個權重，因此當分類器看到一個新圖像就會根據權重給予像素強度並且計算分數總和。3s 與 5s&nbsp;只有幾個像素不同，因此很容易就造成混淆。</p>
<p>最後是分類的另一種方式：<code>Multilabel classification</code> 某些時候對於一種 instance 我們希望輸出多種類別，例如照片的分辨：Alice, Mary, Tome 三人在一張照片裡面我們可能會希望輸出這樣結果 [1, 0, 1], Alice:Yes, Mary:No, Tom:Yes。這種輸出多個 label 的二元分類就是稱為 <code>multilabel classification system</code> </p>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'chairco';
                var disqus_identifier = 'posts/2017/12/day2_machine_learning_in_python_using_scikit-learn_and_tensorflow.html';
                var disqus_url = 'https://chairco.github.io/posts/2017/12/day2_machine_learning_in_python_using_scikit-learn_and_tensorflow.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://chairco.github.io/archives.html">Archives</a></li>
                            <li><a href="https://chairco.github.io/tags.html">Tags</a></li>
                            <li><a href="https://chairco.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                            <li><a href="https://chairco.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://github.com/chairco" target="_blank">Github</a></li>
                            <li><a href="https://twitter.com/ChaircoChen" target="_blank">Twitter</a></li>
                            <li><a href="mailto:chairco@gmail.com" target="_blank">Email</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; Jason's Blog 2018</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>